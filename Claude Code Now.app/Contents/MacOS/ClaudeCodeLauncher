#!/bin/bash

# ğŸ–¥ Claude Code Now - å³æ—¶å¯åŠ¨ï¼Œæ— éœ€ç¡®è®¤
# è·å–ä¼ å…¥çš„è·¯å¾„å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
TARGET_DIR="$1"

# è®¾ç½®å®Œæ•´çš„PATHï¼ŒåŒ…å«å¸¸è§çš„Node.jså’ŒCLIå·¥å…·è·¯å¾„
export PATH="$HOME/.nvm/versions/node/v22.17.1/bin:$HOME/.npm-global/bin:/usr/local/bin:/opt/homebrew/bin:$PATH"

# å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°è¯•è·å–Finderçš„å½“å‰è·¯å¾„
if [ -z "$TARGET_DIR" ]; then
    # ä½¿ç”¨AppleScriptè·å–Finderå½“å‰è·¯å¾„
    TARGET_DIR=$(osascript -e '
        tell application "Finder"
            try
                set currentPath to POSIX path of (target of front window as alias)
            on error
                set currentPath to ""
            end try
        end tell
    ')
fi

# å¦‚æœæ²¡æœ‰è·å–åˆ°è·¯å¾„ï¼Œä½¿ç”¨é»˜è®¤ç›®å½•
if [ -z "$TARGET_DIR" ]; then
    TARGET_DIR="/Users/oran/Documents/Claude Code"
fi

# æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
if [ ! -d "$TARGET_DIR" ]; then
    osascript -e "display alert \"é”™è¯¯\" message \"ç›®å½• '$TARGET_DIR' ä¸å­˜åœ¨\""
    exit 1
fi

# æ£€æŸ¥Claude Codeæ˜¯å¦å·²å®‰è£…
if ! command -v claude >/dev/null 2>&1; then
    osascript -e "display alert \"Claude Code æœªå®‰è£…\" message \"è¯·æ£€æŸ¥ Claude Code CLI æ˜¯å¦æ­£ç¡®å®‰è£…å¹¶åœ¨ PATH ä¸­\""
    exit 1
fi

# å¯åŠ¨Terminalå¹¶åœ¨æŒ‡å®šç›®å½•è¿è¡ŒClaude Code
osascript <<EOF
tell application "Terminal"
    activate
    do script "export PATH=\"$PATH\" && cd " & quoted form of "$TARGET_DIR" & " && claude --permission-mode bypassPermissions"
end tell
EOF